# AWS SFTP Transfer-family Terraform module

Terraform module which creates SFTP Transfer-family resources on AWS.

These types of resources are supported:

* [Transfer Server](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/transfer_server)
* [Transfer SSH Key](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/transfer_ssh_key)
* [Transfer User](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/transfer_user)

## Terraform versions

Tested on Terraform 0.14 and newer. Submit pull-requests to `main` branch.

## Usage

### Transfer Server

SFTP Transfer Server with default actions:

```hcl
module "transfer_sftp" {
  source  = "https://github.com/FlexShopper/terraform-aws-transfer.git?ref=0.1.0"
  
  name_prefix   = "myorg-dev"
  namespace     = "server-01"

  # Provide an SFTP private key if you are migrating users from an existing sftp server
  #
  # Development:
  # 1. Put value of private key in a *.tfvars file that is not part of version control [heredoc-strings](https://www.terraform.io/docs/language/expressions/strings.html#heredoc-strings)
  # 2. Get value locally *.tfvars file 
  #
  # Staging | Production:
  # 1. Put value of private key in an encrypted string using a Secret Manager, (e.g. AWS SSM Parameter, AWS Secrets, Hashicorp Vault)
  # 2. Get value from Secret Manager

  host_key = var.host_key

  # Route53 DNS Alias
  custom_hostname_route53 = "sftp"
  route53_zone_name       = "example.com"

  tags = {
    environment = "development"
  }
}
```

## Tested

| Name | Version |
|------|---------|
| terraform | >= 0.14.0 |
| aws | >= 3.33.0 |

## Providers

| Name | Version |
|------|---------|
| aws | >= 3.33.0 |

## Modules

| [user](https://github.com/FlexShopper/terraform-aws-transfer/tree/main/modules/user) |

## Resources

| Name |
|------|
| [aws_cloudwatch_log_group](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_log_group) |
| [aws_iam_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role) |
| [aws_iam_policy](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_policy) |
| [aws_iam_role_policy_attachment](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy_attachment) |
| [aws_s3_bucket](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket) |
| [aws_s3_bucket_public_access_block](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block) |
| [aws_transfer_server](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/transfer_server) |
| [null_resource](https://registry.terraform.io/providers/hashicorp/null/latest/docs/resources/resource) |

## Inputs

### Required

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| name\_prefix | Prefix name added to resources. | `string` | `"null"` | yes |
| namespace | Namespace to apply to all resources to avoid conflicting with other Transfer Servers. | `string` | `"default-transfer-server"` | yes |

### Optional

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| create\_ftps\_server | Controls if the FTPS Server should be created. | `bool` | `false` | no |
| create\_sftp\_server | Controls if the SFTP Server should be created. | `bool` | `true` | no |
| custom\_hostname\_route53 | Create custom hostname as a Route53 DNS alias. Conflicts with `custom_hostname_other_dns` | `string` | `"null"` | no |
| custom\_hostname\_other\_dns | Create custom hostname that you own in an external DNS service. Conflicts with 'custom_hostname_route53' | `string` | `"null"` | no |
| endpoint\_details | Map of VPC endpoint settings that you want to configure for your SFTP server. | `map(any)` | `{}` | no |
| endpoint\_type | The type of endpoint that you want your SFTP server connect to. If you connect to a `VPC` (or `VPC_ENDPOINT`), your SFTP server isn't accessible over the public internet. If you want to connect your SFTP server via public internet, set PUBLIC. Defaults to PUBLIC. | `string` | `PUBLIC` | no |
| force\_destroy | A boolean that indicates all users associated with the server should be deleted so that the Server can be destroyed without error. The default value is false. | `bool` | `false` | no |
| host\_key | RSA private key (e.g. as generated by the ssh-keygen -N "" -m PEM -f my-new-server-key command). | `string` | `"null"` | no |
| invocation\_role | Amazon Resource Name (ARN) of the IAM role used to authenticate the user account with an identity_provider_type of API_GATEWAY | `string` | `"null"` | no |
| identity\_provider\_type | The mode of authentication enabled for this service. The default value is SERVICE_MANAGED, which allows you to store and access SFTP user credentials within the service. API_GATEWAY indicates that user authentication requires a call to an API Gateway endpoint URL provided by you to integrate an identity provider of your choice. | `string` | `SERVICE_MANAGED` | no |
| log\_retention | Cloudwatch Log Group Retention for Transfer Server. | `number` | `30` | no |
| route53\_zone\_name | Name of route53 zone, (e.g. www.example.com.) This is required if `custom_hostname_route53` variable is used. | `string` | `"null"` | no |
| security_policy_name | Specifies the name of the security policy that is attached to the server. | `string` | `"TransferSecurityPolicy-2020-06"` | no |
| s3\_acl | Canned ACL to apply on S3 Bucket. | `string` | `"private"` | no |
| s3\_disable\_public\_access | Enable/disable public access on s3 bucket. By default public access blocked. | `bool` | `true` | no |
| s3\_force\_destroy | A boolean that indicates all objects (including any locked objects) should be deleted from the bucket so that the bucket can be destroyed without error. | `bool` | `false` | no |
| s3\_versioning | Enable versioning. | `bool` | `false` | no |
| tags | A map of tags to assign to the resource. | `bool` | `false` | no |
| url | URL of the service endpoint used to authenticate users with an identity_provider_type of API_GATEWAY | `string` | `"null"` | no |

## Outputs

| Name | Description |
|------|-------------|
| iam\_role\_arn | Amazon Resource Name (ARN) of IAM Service role for Transfer Server to access S3 and Cloudwatch Logs. |
| s3\_bucket\_id | S3 Bucket name. |
| server\_arn | Amazon Resource Name (ARN) of Transfer Server. |
| server\_id | The Server ID of the Transfer Server (e.g. s-12345678). |
| server\_endpoint | The endpoint of the Transfer Server (e.g. s-12345678.server.transfer.REGION.amazonaws.com) |
| host\_key\_fingerprint | This value contains the message-digest algorithm (MD5) hash of the server's host key. |


## Authors

Module managed by [Steven Almonte](https://github.com/salmonte-flexshopper).

## License

Apache 2 Licensed. See LICENSE for full details.

