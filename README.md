# AWS SFTP and FTPS Transfer-family Terraform module

Terraform module which creates SFTP Transfer-family resources on AWS.

These types of resources are supported:

* [Transfer Server](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/transfer_server)

`TODO`

* [Transfer SSH Key](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/transfer_ssh_key)
* [Transfer User](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/transfer_user)

## Terraform versions

Terraform 0.14 and newer. Submit pull-requests to `main` branch.

## Usage

### Transfer Server

SFTP Transfer Server with default actions:

```hcl
module "transfer_sftp" {
  source  = "https://github.com/FlexShopper/terraform-aws-transfer.git?ref=0.1.0"
  
  name_prefix   = "myorg-dev"
  namespace     = "server-01"

  # Provide an SFTP private key if you are migrating users from an existing sftp server
  #
  # Development:
  # 1. Put value of private key in a *.tfvars file that is not part of version control [heredoc-strings](https://www.terraform.io/docs/language/expressions/strings.html#heredoc-strings)
  # 2. Get value locally *.tfvars file 
  #
  # Staging | Production:
  # 1. Put value of private key in an encrypted string using a Secret Manager, (e.g. AWS SSM Parameter, AWS Secrets, Hashicorp Vault)
  # 2. Get value from Secret Manager

  host_key = var.host_key

  # Route53 DNS Alias
  custom_hostname_route53 = "sftp"
  route53_zone_name       = "example.com"

  tags = {
    environment = "development"
  }
}
```

## Tested

| Name | Version |
|------|---------|
| terraform | >= 0.14.0 |
| aws | >= 3.33.0 |

## Providers

| Name | Version |
|------|---------|
| aws | >= 3.33.0 |

## Modules

| [user](./user) |

## Resources

| Name |
|------|
| [aws_cloudwatch_log_group](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_log_group) |
| [aws_iam_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role) |
| [aws_iam_policy](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_policy) |
| [aws_iam_role_policy_attachment](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy_attachment) |
| [aws_s3_bucket](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket) |
| [aws_s3_bucket_public_access_block](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block) |
| [aws_transfer_server](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/transfer_server) |
| [null_resource](https://registry.terraform.io/providers/hashicorp/null/latest/docs/resources/resource) |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| endpoint\_details | Map of VPC endpoint settings that you want to configure for your SFTP server. | `map(any)` | `{}` | no |
| endpoint\_type | The type of endpoint that you want your SFTP server connect to. If you connect to a `VPC` (or `VPC_ENDPOINT`), your SFTP server isn't accessible over the public internet. If you want to connect your SFTP server via public internet, set PUBLIC. Defaults to PUBLIC. | `string` | `PUBLIC` | no |
| invocation\_role | Amazon Resource Name (ARN) of the IAM role used to authenticate the user account with an identity_provider_type of API_GATEWAY | `string` | `"null"` | no |
| host\_key | RSA private key (e.g. as generated by the ssh-keygen -N "" -m PEM -f my-new-server-key command). | `string` | `"null"` | no |
| url | URL of the service endpoint used to authenticate users with an identity_provider_type of API_GATEWAY | `string` | `"null"` | no |
| identity\_provider\_type | The mode of authentication enabled for this service. The default value is SERVICE_MANAGED, which allows you to store and access SFTP user credentials within the service. API_GATEWAY indicates that user authentication requires a call to an API Gateway endpoint URL provided by you to integrate an identity provider of your choice. | `string` | `SERVICE_MANAGED` | no |
| logging\_role | Amazon Resource Name (ARN) of an IAM role that allows the service to write your SFTP usersâ€™ activity to your Amazon CloudWatch logs for monitoring and auditing purposes. | `string` | `"null"` | no |
| force\_destroy | A boolean that indicates all users associated with the server should be deleted so that the Server can be destroyed without error. The default value is false. | `bool` | `false` | no |
| tags | A map of tags to assign to the resource. | `bool` | `false` | no |

## Outputs

| Name | Description |
|------|-------------|
| iam_logging_role_arn | Amazon Resource Name (ARN) of IAM Service role for Transfer Server to upload Cloudwatch logs. |
| iam_s3_role_arn | Amazon Resource Name (ARN) of IAM Service role for Transfer Server to access S3. |
| s3_bucket_id | S3 Bucket name. |
| server_arn | Amazon Resource Name (ARN) of Transfer Server. |
| server_id | The Server ID of the Transfer Server (e.g. s-12345678). |
| server_endpoint | The endpoint of the Transfer Server (e.g. s-12345678.server.transfer.REGION.amazonaws.com) |
| host_key_fingerprint | This value contains the message-digest algorithm (MD5) hash of the server's host key. |


## Authors

Module managed by [Steven Almonte](https://github.com/salmonte-flexshopper).

## License

Apache 2 Licensed. See LICENSE for full details.

